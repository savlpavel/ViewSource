<?xml version="1.0" encoding="UTF-8"?>
<agent xmlns="http://www.lotus.com/dxl" name="(SRunner)" alias="SRunner" hide="v3" publicaccess="false">
  <trigger type="actionsmenu"/>
  <documentset type="runonce"/>
  <code event="options">
    <lotusscript>%REM
	Agent (SRunner)
	Created Sep 1, 2016 by Pavel A Aleshkevich/DV2/RU
	Description: Comments for Agent
%END REM
Option Public
Option Declare
Use "RunnerLib"

</lotusscript>
  </code>
  <code event="declarations">
    <lotusscript>Private Const DESIGN = {}
Private Const nLine={
}

Declare Function NEMGetCurrentSubprogramWindow Lib "nnotesws.dll" () As Long
Declare Function NEMStopSubprogramWindow Lib "nnotesws.dll" (Byval wHandle As Long) As Integer
Declare Sub KeyPress Lib "user32" Alias "keybd_event" _
( Byval bVk As Any, Byval S As Integer, Byval F As Integer, Byval E As Integer)

</lotusscript>
  </code>
  <code event="initialize">
    <lotusscript>Sub Initialize
		
	Dim ws As New NotesUIWorkspace
	Dim session As New NotesSession
	
	Dim dbCurrent As NotesDatabase
	Dim dbSource As NotesDatabase
	Dim vwSource As NotesView
	Dim dlgDoc As NotesDocument
		
	Dim dbName As String 
	Dim ServerName As String
	Dim dbView As String 
	Dim DocGUID As String 
	
	Const SOURCE_FORM_NAME = "dlgScript" 
	Const  ENV_SERVER = "SN_ViewSource"
	Const  ENV_DB = "DBN_ViewSource"
	Const  ENV_VW = "VW_ViewSource"
	Const  ENV_DOC = "DUI_ViewSource"

	Set dbCurrent = session.CurrentDatabase

	ServerName = session.GetEnvironmentString(ENV_SERVER)
	dbName = session.GetEnvironmentString(ENV_DB)
	dbView = session.Getenvironmentstring(ENV_VW)

	Set dbSource = session.GetDatabase(ServerName, dbName)
	If dbSource Is Nothing Then Error 5001, {Не найдена база-источник.}
	If Not dbSource.Isopen Then Error 5002, {База-источник недоступна.}
		
	Set vwSource = dbSource.Getview(dbView)
	
	If vwSource Is Nothing Then Error 5003, {Не найдено представление: } &amp; dbView
	
	Set sdList = New SelectedDocsList(vwSource)
	
	If sdList.Count() &lt; 1 Then
		Msgbox {Ничего не выбрано.}, 16 
		Exit Sub
	End If
	
	Set dlgDoc = New NotesDocument(dbCurrent)
	
	If sdList.Count() = 1 Then
		Set param = sdList.GetFirstDocument()
		Call dlgDoc.Replaceitemvalue("IsDocument", "1")
	Else
		Set param = sdList
	End If
	
	Call ws.Dialogbox(SOURCE_FORM_NAME, True, True, True, False, False, False, "Runner", dlgDoc, True, True)
	
	Dim dScr As String
	
	dScr = dlgDoc.Getitemvalue("Script.Text")(0)
	
	Execute(dScr)
	
End Sub</lotusscript>
  </code>
</agent>